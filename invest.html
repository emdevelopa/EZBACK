<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Page</title>
</head>

<body>

    <h1>Investment Page</h1>

    <form>
        <label for="investmentAmount">Enter Investment Amount:</label>
        <input type="number" id="investmentAmount" name="investmentAmount" placeholder="Enter amount" required>
        <br>
        <button type="button" onclick="invest()">Invest</button>
    </form>

    <div id="investmentList">
        <h2>My Investments</h2>
        <table border="1">
            <thead>
                <tr>
                    <th>Amount Invested</th>
                    <th>Status</th>
                    <th>Start</th>
                    <th>End</th>
                </tr>
            </thead>
            <tbody id="investmentTableBody">
                <!-- Investment data will be displayed here -->
            </tbody>
        </table>
    </div>

<script>
    async function invest() {
        try {
            var amountInvested = document.getElementById("investmentAmount").value;

            // Retrieve existing data from local storage
            const storedData = localStorage.getItem("wallets") || "[]";
            const data = JSON.parse(storedData);

            let user = {
                balance: 20000,
                amountInvested,
                status: "pending",
                start: 0,
                end: 0 + 30
            };

            // Add the new user data to the existing array
            data.push(user);

            // Store the initial array back to local storage
            localStorage.setItem("wallets", JSON.stringify(data));

            // Display the investment data
            displayInvestments(data);

            // Set interval to update the start value
            const intervalId = setInterval(() => {
                // Update start values at intervals here
                data.forEach((user) => {
                    if (user.status === "pending") {
                        user.start++;

                        // Check if start is equal to end
                        if (user.start === user.end) {
                            // Update the status to "successful" only once
                            if (user.status !== "successful") {
                                user.status = "successful";
                                console.log("Investment successful!", data);
                            }
                        }
                    }
                });

                // Store the updated array back to local storage
                localStorage.setItem("wallets", JSON.stringify(data));

                // Display the investment data
                displayInvestments(data);

                // Check if all investments are successful
                const allSuccessful = data.every(user => user.status === "successful");

                // If all investments are successful, clear the interval
                if (allSuccessful) {
                    clearInterval(intervalId);
                }

                console.log("Start values updated:", data);
            }, 1000);
        } catch (error) {
            console.error(error);
            alert("An error occurred. Please try again later.");
        }
    }

    function displayInvestments(data) {
        const tableBody = document.getElementById("investmentTableBody");
        tableBody.innerHTML = ""; // Clear the previous content

        data.forEach((user) => {
            const row = document.createElement("tr");
            row.innerHTML = `<td>${user.amountInvested}</td>
                            <td>${user.status}</td>
                            <td>${user.start}</td>
                            <td>${user.end}</td>`;
            tableBody.appendChild(row);
        });
    }
</script>

</body>

</html>